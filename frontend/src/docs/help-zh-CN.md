# EasyMark 使用指南

EasyMark 是一款专业的计算机视觉标注工具，支持矩形框、多边形、关键点等多种标注类型，并集成了 AI 辅助标注、数据集管理、模型训练等完整工作流。

---

## 1. 标注

### 1.1 创建/选择项目

1. 打开程序后，点击左侧的**项目管理器**
2. 点击右上角的**项目菜单**选择或创建一个项目

### 1.2 导入图片或数据集

创建项目后，可以导入图片或导入已有数据集：

- **支持的数据集格式**：YOLO、VOC、COCO
- **导入方式**：
  - **复制**：将文件复制到项目目录
  - **硬链接**：创建硬链接节省磁盘空间
  - **外部索引**：仅索引不复制，保留原始位置

### 1.3 配置标注类别

在右侧面板切换需要标注的类型：

| 类型 | 说明 |
|------|------|
| **矩形框** | 目标检测常用 |
| **多边形** | 实例分割/语义分割 |
| **关键点** | 姿态估计，需先配置各点语义并绑定矩形框类别 |

> **关键点说明**：关键点需要绑定一个矩形框类别。推理时，同矩形框类别的检测结果会自动使用绑定的关键点语义。

### 1.4 开始标注

1. 点击左侧图片列表中的图片，中间画布会显示该图片
2. 先选择类别（可同时选中矩形框和关键点类别，但多边形不能与其他类别同时选中）
3. 绘制标注：
   - **矩形框**：按住鼠标左键拖拽绘制
   - **多边形/关键点**：按住 `Alt` + 鼠标左键绘制
   - **取消绘制**：多边形和关键点未完成时，右键点击空白区域取消

### 1.5 保存标注

- 点击**保存按钮**手动保存
- 或开启底部栏的**自动保存**功能

### 1.6 AI 辅助标注

程序内置 2 个辅助标注插件：

| 插件 | 使用方式 |
|------|----------|
| **SAM2** | 加载模型后，选中多边形或矩形框类别，按住 `Shift` 点击目标进行分割推理 |
| **YOLO** | 选中模型后，切换图片会自动推理 |

点击底部栏的**插件按钮**打开插件小窗进行推理操作。

> **注意**：推理渲染的结果需要**手动保存**，自动保存不会保存推理结果。

---

## 2. 数据集

### 2.1 进入数据集页面

完成标注后，点击左侧栏的**数据集管理**按钮进入数据集页面。

### 2.2 同步版本

鼠标悬浮项目后，点击**同步按钮**可更新或创建该项目的数据集版本。

### 2.3 导出数据集

1. 选中不同项目、不同版本内的类别（支持跨项目、跨版本多选，但不支持同项目内不同版本的相同类别）
2. 点击右上角出现的**导出数据集**按钮
3. 选择导出路径、格式、数据集划分比例
4. 点击**开始导出**

### 2.4 版本管理

右键左侧树结构中的某个版本：

- **删除**：删除该版本
- **回溯**：二次确认后，将项目恢复到此版本的状态

---

## 3. 训练

### 3.1 进入训练页面

点击左侧栏的**训练管理**按钮进入训练页面。

### 3.2 前置条件

开始训练前请确保：
- 相关插件已就绪
- 插件依赖已安装（见 Python 环境管理章节）

### 3.3 创建训练集

1. 点击**创建训练集**按钮
2. 选择版本中的类别（支持同项目内不同版本的相同类别，但不支持跨项目选类）
3. 输入训练集名称，点击确定

已保存的训练集可在右侧进行删除或更新（更新：将训练集中的类别替换为当前选中的类别）。

### 3.4 新建训练任务

1. 点击**新建训练任务**
2. 配置训练参数：
   - 训练名称
   - 选择训练集或从目录选择数据集
   - 配置数据划分（训练集、验证集比例）
   - 选择训练类型（矩形框、多边形、关键点）
   - 选择训练插件、模型与版本
   - 配置训练超参数
3. 点击确定开始训练

### 3.5 训练结果

- 训练完成后显示在右侧**训练历史**中
- 可直接删除或打开目录查看模型和指标
- 训练好的模型会自动导入到 YOLO 推理插件中

---

## 4. 插件

### 4.1 插件系统

插件系统已完成基础框架搭建，可用于：
- 数据集导入导出
- 训练
- 推理辅助标注

> 开发插件请参考 `host-plugins` 目录的示例源码及文档。

### 4.2 内置插件

| 插件 | 功能 |
|------|------|
| **SAM2** | 分割辅助标注 |
| **格式转换** | 支持 YOLO、COCO、VOC 格式 |
| **Ultralytics YOLO** | 推理和训练 |

### 4.3 安装插件

从其他渠道获取的插件为 `.rar` 或 `.zip` 压缩包，点击**从磁盘安装**按钮安装。

### 4.4 卸载与更新

- **卸载**：会同时删除该插件已部署的虚拟环境
- **更新**：直接覆盖安装即可

> 插件市场敬请期待。

---

## 5. Python 环境管理

### 5.1 进入环境管理

点击左侧栏的 **Python 环境管理**按钮进入页面。

### 5.2 依赖检测

进入页面后，系统会自动检测需要 Python 环境的插件的依赖安装状态，未安装的插件会有明显提醒。

### 5.3 前置条件

部署环境前请确保：
- 系统已安装 Python
- Python 已添加到系统环境变量 PATH 中

### 5.4 部署流程

1. 点击需要配置的插件
2. 查看该插件的所需依赖
3. 点击**创建虚拟环境**
4. 环境创建完成后，点击**安装依赖**

> **提示**：部分情况下依赖安装可能失败，请使用 pip 命令手动安装合适版本的依赖。

---

## 6. 键盘快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl + S` | 保存当前图片标注 |
| `Ctrl + Shift + S` | 保存为负样本 |
| `← / →` | 上一张 / 下一张图片 |
| `Ctrl + ← / →` | 跳转上/下一张未标注图片 |
| `Backspace` | 删除选中的标注 |
| `V` | 切换关键点可见性 |
| `Ctrl + 0` | 重置画布视图 |

---

## 7. 常见问题

### 看不到图片或数据集
- 检查设置页中的**数据根目录**是否配置正确
- 确认后端服务已正常启动

### 训练或导出无响应
- 查看训练页底部的日志输出
- 确认 Python 环境和显卡驱动已正确安装

### 插件安装失败
- 确认压缩包格式为 `.zip` 或 `.rar`
- 查看安装对话框中的错误提示

### 依赖安装失败
- 检查网络连接
- 尝试使用 pip 命令手动安装
- 确认 Python 版本兼容性

### 推理插件加载模型失败 (c10.dll 错误)
- **原因**：系统缺少 Microsoft Visual C++ Redistributable 运行时库
- **解决**：下载安装 [VC++ Redistributable](https://aka.ms/vs/17/release/vc_redist.x64.exe)，安装后重启应用
